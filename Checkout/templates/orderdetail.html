{% extends 'Shop/main.html' %}
{% load static %}
{% load widget_tweaks %}
{% load humanize %}
{% block head %}
<style>
        .update-order {
            border-radius: 7px;
            margin-top: 1%;
            margin-bottom: 1%;
            width: 100%;
            color: #222222;
            background: #fff;
            border-color: #222222;
            font-weight: 700;
            -webkit-border-radius: 7px;
            -moz-border-radius: 7px;
            -ms-border-radius: 7px;
            -o-border-radius: 7px;
        }

        .update-order:hover {
            border-color: #D10024;
            background-color: #D10024;
            color: #fff;
            outline: 0 none;
        }

        .update-order:focus {
            border-color: #D10024;
            background-color: #D10024;
            color: #fff;
            outline: 0 none;
        }

       .btn-primary.active.focus, .btn-primary.active:focus, .btn-primary.active:hover, .btn-primary:active.focus, .btn-primary:active:focus, .btn-primary:active:hover, .open>.dropdown-toggle.btn-primary.focus, .open>.dropdown-toggle.btn-primary:focus, .open>.dropdown-toggle.btn-primary:hover {
            border-color: #D10024;
            background-color: #D10024;
            color: #fff;
            outline: 0 none;
}

       .btn.active.focus, .btn.active:focus, .btn.focus, .btn:active.focus, .btn:active:focus, .btn:focus {
    border-color: #D10024;
            background-color: #D10024;
            color: #fff;
            outline: 0 none;
}

</style>
{% endblock %}

{% block content %}
<nav id="navigation">
    <div class="container">
        <!-- responsive-nav -->
        <div id="responsive-nav">
            <!-- NAV -->
            <ul class="main-nav nav navbar-nav">
                <li><a href="{% url 'home' %}">Trang chủ</a></li>
                <li><a href="{% url 'store' %}">Cửa hàng</a></li>
                <li><a href="{% url 'aboutUs' %}">Chúng tôi</a></li>
                <li><a href="{% url 'contact' %}">Liên hệ</a></li>
            </ul>
            <!-- /NAV -->
        </div>
        <!-- /responsive-nav -->
    </div>
</nav>

<div class="container">
    <form method="post">
        {% csrf_token %}
        <h2 style="margin-top: 30px;">Chi tiết đơn hàng</h2>
        <div class="row"
             style="transform: translate3d(0px, 0px, 0px);box-shadow: 2px 4px 4px #eee;border-radius:6px;margin-top: 30px;">

            <div class="col-sm-1"
                 style="text-align: center;padding-bottom: 10px;border: 2px solid #f2f2f2;border-right: none;padding-top: 10px;">
                <strong>STT</strong>
                <div class="row" style="margin-top:10px; ">

                    {% for product in order_product %}
                    <div class="col-sm-12"
                         style="text-align: center;margin-bottom: 10px;height: 112px;border: 2px solid #f2f2f2;border-right: none;border-left: none;border-bottom: none;">
                        {{forloop.counter}}.
                    </div>
                    {% endfor %}

                </div>
            </div>

            <div class="col-sm-3"
                 style="text-align: center;padding-bottom: 10px;border: 2px solid #f2f2f2;border-right: none;padding-top: 10px;">
                <strong>Tên sản phẩm</strong>
                <div class="row" style="margin-top:10px">

                    {% for p in order_product %}
                    <div class="col-sm-12"
                         style="text-align: center;margin-bottom: 10px;height: 112px;border: 2px solid #f2f2f2;border-right: none;border-left: none;border-bottom: none;">
                        <a href="#" style="text-decoration: none;">
                            {{p.product.name}}
                        </a>
                    </div>
                    {% endfor %}

                </div>
            </div>

            <div class="col-sm-2"
                 style="text-align: center;padding-bottom: 10px;border: 2px solid #f2f2f2;border-right: none;padding-top: 10px;">
                <strong>Hình ảnh</strong>
                <div class="row" style="margin-top:10px;">

                    {% for p in order_product %}
                    <div class="col-sm-12"
                         style="border: 2px solid #f2f2f2;border-right: none;border-left: none;border-bottom: none; ">
                        <img src="{{p.product.ImageURL}}" width="120" height="120" alt="">
                    </div>
                    {% endfor %}

                </div>
            </div>

            <div class="col-sm-2"
                 style="text-align: center;padding-bottom: 10px;border: 2px solid #f2f2f2;border-right: none;padding-top: 10px;">
                <strong>Số lượng</strong>
                <div class="row" style="margin-top:10px">

                    {% for p in order_product %}
                    <div class="col-sm-12"
                         style="text-align: center;margin-bottom: 10px;height: 112px;border: 2px solid #f2f2f2;border-right: none;border-left: none;border-bottom: none;">
                        {{p.quantity}}
                    </div>
                    {% endfor %}

                </div>
            </div>

            <div class="col-sm-2"
                 style="text-align: center;padding-bottom: 10px;border: 2px solid #f2f2f2;border-right: none;padding-top: 10px;">
                <strong>Giá tiền</strong>
                <div class="row" style="margin-top:10px">

                    {% for p in order_product %}
                    <div class="col-sm-12"
                         style="text-align: center;margin-bottom: 10px;height: 112px;border: 2px solid #f2f2f2;border-right: none;border-left: none;border-bottom: none;">
                        {{p.product.price|intcomma}},000 Vnd
                    </div>
                    {% endfor %}

                </div>
            </div>

            <div class="col-sm-2"
                 style="text-align: center;padding-bottom: 10px;border: 2px solid #f2f2f2;padding-top: 10px;"><strong>Ngày
                đặt</strong>
                <div class="row" style="margin-top:10px">
                    {% for p in order_product %}
                    <div class="col-sm-12"
                         style="text-align: center;margin-bottom: 10px;height: 112px;border: 2px solid #f2f2f2;border-right: none;border-left: none;border-bottom: none;">
                        {{p.date_order}}
                    </div>
                    {% endfor %}
                </div>
            </div>

        </div>
        <br>
        <div class="row" style="margin-top:50px;">
            <div class="col-sm-5" style="float: right;text-align: right;">
                <h3>
                    Tổng số tiền thanh toán:
                </h3>
                <br>
                <h3>
                    {{order.get_total_price_product|intcomma}},000 Vnd
                </h3>
            </div>
        </div>
        <br>
        <div class="row" style="margin-bottom:30px">
            <div class="col-sm-2 col-sm-offset-5" style="width:20%">
                <button type="submit" data-action="cancel" data-id={{order.id}} class="btn btn-primary update-order"
                        id="button-submit" style="height:50px;border-radius:48px;">HỦY BỎ
                </button>
            </div>
            <div class="col-sm-2 col-sm-offset-4" style="width:20%">
                <button type="submit" data-action="cancel" data-id={{order.id}} class="btn btn-primary update-order"
                        id="button-submit1" style="height:50px;border-radius:48px;">HỦY BỎ
                </button>
            </div>
            <div class="col-sm-2" style="width:20%;">
                <button type="submit" data-action="accept" data-id={{order.id}} class="btn btn-primary update-order"
                        id="button-submit2" style="height:50px;border-radius:48px;">HOÀN THÀNH
                </button>
            </div>
        </div>
    </form>
</div>

<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.0.min.js"></script>

<script>
        var order = '{{order.status}}';

        if(order == "New"){
            $("#button-submit1").hide();
            $("#button-submit2").hide();
        }else if(order == "Canceled" || order == "Success" || order == "Completed"){
            $("#button-submit").hide();
            $("#button-submit1").hide();
            $("#button-submit2").hide();
        } else{
            $("#button-submit").hide();
        }
        function Update(productId,action){
            console.log("ID:",productId,"action:",action)

    var url ='../../update_order/'
    fetch(url,{
        method:'POST',
        headers:{
            'Content-Type':'application/json',
            'X-CSRFToken':csrftoken,
        },
        body:JSON.stringify({'Id':productId,'action':action})

    })
    .then((response) =>{
        return response.json();
    })
    .then((data) =>{
        location.reload();
    });

}
      var updateBtns = document.getElementsByClassName('update-order');
for(var i = 0 ; i < updateBtns.length;i++){
    updateBtns[i].addEventListener('click',function(){
            Id = this.dataset.id;
            action = this.dataset.action;


    console.log('User:'+user);
    if(user == 'AnonymousUser'){
        console.log('User is not authenticated')

    }else{
        Update(Id,action);
    }
 });

}


</script>
{% endblock %}